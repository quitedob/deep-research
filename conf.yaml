# -*- coding: utf-8 -*-
# Deep Research 统一配置文件 - 智能路由版
# 
# 此配置文件支持智能路由系统，自动选择最佳模型和工作流

# --- LLM 后端配置 ---
# 主要LLM后端: OLLAMA (本地) | DEEPSEEK (云端) | KIMI (云端)
# 系统会根据任务类型和可用性自动选择最佳提供者
PRIMARY_LLM_BACKEND: "OLLAMA"  # 优先使用的后端
FALLBACK_LLM_BACKEND: "DEEPSEEK"  # 备用后端

# --- Ollama 本地模型配置 ---
OLLAMA_BASE_URL: "http://localhost:11434/v1"
OLLAMA_SMALL_MODEL: "gemma3:4b"     # 用于简单聊天、路由分类
OLLAMA_LARGE_MODEL: "qwen3:32b"     # 用于复杂推理、研究任务
OLLAMA_VISION_MODEL: "qwen2.5vl:7b" # 用于多模态任务

# Ollama连接配置
OLLAMA_CONNECTION_TIMEOUT: 30.0
OLLAMA_READ_TIMEOUT: 120.0
OLLAMA_RETRY_ATTEMPTS: 3

# --- DeepSeek API 配置 ---
# 支持多种模型，根据任务类型自动选择
DEEPSEEK_BASE_URL: "https://api.deepseek.com/v1"
DEEPSEEK_ENABLE_OFF_PEAK_OPTIMIZATION: true  # 启用错峰优化

# DeepSeek模型映射
DEEPSEEK_MODELS:
  chat: "deepseek-chat"        # 通用对话、数据分析
  reasoner: "deepseek-reasoner"  # 深度推理、复杂分析

# DeepSeek任务类型到temperature的映射
DEEPSEEK_TEMPERATURE_MAP:
  code: 0.0          # 代码生成/数学解题
  math: 0.0          # 数学问题
  analysis: 1.0      # 数据分析
  chat: 1.3          # 通用对话
  translation: 1.3   # 翻译任务
  creative: 1.5      # 创意写作/诗歌
  poetry: 1.5        # 诗歌创作

# --- 智能路由配置 ---
# 根据任务类型配置提供者优先级
PROVIDER_PRIORITY:
  triage: ["ollama", "deepseek"]      # 路由分类优先本地
  simple_chat: ["ollama", "deepseek"] # 简单聊天优先本地
  code: ["deepseek", "ollama"]        # 代码任务优先DeepSeek
  reasoning: ["deepseek", "ollama"]   # 推理任务优先DeepSeek
  research: ["deepseek", "ollama"]    # 研究任务优先DeepSeek
  creative: ["deepseek", "ollama"]    # 创意任务优先DeepSeek
  general: ["ollama", "deepseek"]     # 通用任务优先本地

# 路由置信度阈值
TRIAGE_CONFIDENCE_THRESHOLD: 0.7  # 低于此置信度将使用更强模型

# --- 全局 LLM 模型配置（向后兼容） ---
# 这些配置主要用于不支持智能路由的旧组件
BASIC_MODEL:
  model_name: "deepseek-chat"
  temperature: 1.0
  max_tokens: 4000

REASONING_MODEL:
  model_name: "deepseek-reasoner"
  temperature: 1.0
  max_tokens: 32000

VISION_MODEL:
  model_name: "qwen2.5vl:7b"
  temperature: 0.0
  max_tokens: 4000

# --- 搜索与记忆配置 ---
# 默认搜索引擎
SEARCH_ENGINE: "KIMI"

# 是否启用 Mem0 长期记忆
ENABLE_MEM0: true
MEM0_INDEX_PATH: "./data/mem0_index"

# --- RAG 与向量知识库配置 ---
RAG_INDEX_PATH: "./data/rag_documents"
VECTOR_STORE_PATH: "./data/vector_store"

# --- 融合检索配置 ---
ENABLE_FUSED_SEARCH: true
SEARCH_CACHE_TTL: 3600  # 搜索结果缓存时间（秒）
FUSED_SEARCH_ENGINES: ["TAVILY", "ARXIV", "RAG"]

# --- 上下文管理配置 ---
# 自动分块处理长上下文
ENABLE_CONTEXT_SPLITTING: true
CONTEXT_SPLIT_THRESHOLD: 0.8  # 超过上下文限制的80%时开始分块
MAX_CONTEXT_CHUNKS: 5         # 最大分块数量

# --- 输出配置 ---
OUTPUT_DIR: "./output_reports"

# --- 执行配置 ---
MAX_SEARCH_RESULTS: 10

# --- 工作流配置 ---
# 不同工作流的特定配置
WORKFLOWS:
  main:
    enable_background_investigation: true
    max_plan_iterations: 3
    enable_human_feedback: false  # 生产环境建议关闭

  ppt:
    default_template: "modern"
    max_slides: 20
    enable_charts: true
    # PPT生成专用的提供商优先级
    provider_priority: ["deepseek", "ollama", "domestic"]
    # PPT生成专用的模型配置
    models:
      outline_generation: "deepseek-chat"  # 大纲生成使用聊天模型
      content_generation: "deepseek-reasoner"  # 内容生成使用推理模型
      fallback_model: "ollama:qwen3:7b"  # 降级到本地模型
    # PPT输出配置
    output_dir: "./data/ppt_exports"
    image_cache_dir: "./data/ppt_images"
    # 图片生成配置
    image_service:
      enable_cache: true
      cache_ttl_days: 7
      max_image_size: "1920x1080"
      supported_formats: ["jpg", "png"]
    # 质量控制
    quality_control:
      min_dsl_validation_score: 0.8
      max_retries: 3
      enable_proofreading: true

  podcast:
    default_voice: "female"
    audio_format: "mp3"
    sample_rate: 44100

  prose:
    default_style: "academic"
    max_length: 5000

# --- 性能优化配置 ---
# 并发和性能相关设置
MAX_CONCURRENT_REQUESTS: 10
REQUEST_TIMEOUT: 300  # 秒
ENABLE_CACHING: true
CACHE_TTL: 1800  # 缓存过期时间（秒）

# 健康检查配置
HEALTH_CHECK_INTERVAL: 300  # 健康检查间隔（秒）
HEALTH_CHECK_TIMEOUT: 10    # 健康检查超时（秒）

# --- 日志配置 ---
LOG_LEVEL: "INFO"
LOG_FORMAT: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
ENABLE_REQUEST_LOGGING: true

# --- 安全配置 ---
# CORS配置 - 生产环境应从环境变量读取
# 注意：生产环境建议使用具体的域名，不要使用通配符
CORS_ALLOW_ORIGINS: "http://localhost:3000,http://localhost:8080"  # 逗号分隔的允许域名列表
CORS_ALLOW_CREDENTIALS: true

# 安全强化配置
CORS_ALLOW_METHODS: "GET,POST,PUT,DELETE,OPTIONS"
CORS_ALLOW_HEADERS: "Authorization,Content-Type,X-Requested-With,Accept,Accept-Encoding,Accept-Language,Cache-Control,Connection,Host,User-Agent,X-Request-ID"
CORS_MAX_AGE: 86400  # 24小时

# 会话安全配置
SESSION_SECRET_KEY: "${SESSION_SECRET_KEY:your-secret-key-change-in-production}"  # 生产环境必须更改
JWT_SECRET_KEY: "${JWT_SECRET_KEY:your-jwt-secret-change-in-production}"  # 生产环境必须更改
JWT_ACCESS_TOKEN_EXPIRE_MINUTES: 60
JWT_ALGORITHM: "HS256"

# API密钥配置（通过环境变量设置）
# DEEPSEEK_API_KEY: 通过环境变量设置
# MOONSHOT_API_KEY: 通过环境变量设置
# VOLCENGINE_TTS_APPID: 通过环境变量设置
# VOLCENGINE_TTS_ACCESS_TOKEN: 通过环境变量设置

# --- 实验性功能 ---
# 这些功能仍在开发中，可能不稳定
EXPERIMENTAL_FEATURES:
  enable_multimodal_routing: false  # 多模态路由
  enable_dynamic_model_selection: true  # 动态模型选择
  enable_cost_optimization: true   # 成本优化
  enable_performance_monitoring: false  # 性能监控

# --- 版本信息 ---
CONFIG_VERSION: "2.0.0"
LAST_UPDATED: "2025-01-16"
